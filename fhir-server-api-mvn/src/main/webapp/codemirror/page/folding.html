<!doctype html>

<head>
<title>CodeMirror: Code Folding Demo</title>
<meta charset="utf-8" />
<link rel=stylesheet href="../doc/docs.css">

<link rel="stylesheet" href="../lib/codemirror.css">
<link rel="stylesheet" href="../addon/fold/foldgutter.css" />
<script src="../lib/codemirror.js"></script>
<script src="../addon/fold/foldcode.js"></script>
<script src="../addon/fold/foldgutter.js"></script>
<script src="../addon/fold/brace-fold.js"></script>
<script src="../addon/fold/xml-fold.js"></script>
<script src="../addon/fold/markdown-fold.js"></script>
<script src="../addon/fold/comment-fold.js"></script>
<script src="../mode/javascript/javascript.js"></script>
<script src="../mode/xml/xml.js"></script>
<script src="../mode/markdown/markdown.js"></script>
<script type="text/javascript" src="../../lib/jquery-1.11.2.min.js"></script>

<script>
	var sessionId="123";
	var cm;
	
	function getAuth() {
	
       $.post("http://localhost:8080/fhir-server-api-mvn/resources/i2b2/login",$( "#form1" ).serialize() 
       , function(data, textStatus, xhr){
 	//alert(data);
 	sessionId=xhr.getResponseHeader('session_id');
 	setXmlDisplay(data);
 	getPatients();
});
};

function getPatients() {
		$.ajax({
			url : 'http://localhost:8080/fhir-server-api-mvn/resources/i2b2/patientall;jsessionid='+sessionId,
			xhrFields: {
      			withCredentials: true
   			},
			type : 'GET',
			dataType: 'text',
			success : function(data) {
				//alert( );
				setXmlDisplay(data);
			}
		});
	};

	function setXmlDisplay(displayText) {
		var te_html = document.getElementById("code-xml");
		if(cm!=null) {
			cm.toTextArea();
			cm=null;
		}
		te_html.value = displayText;
		
		if(cm==null){
		cm = CodeMirror.fromTextArea(te_html, {
			mode : "text/xml",
			lineNumbers : true,
			lineWrapping : true,
			extraKeys : {
				"Ctrl-Q" : function(cm) {
					cm.foldCode(cm.getCursor());
				}
			},
			foldGutter : true,
			gutters : [ "CodeMirror-linenumbers", "CodeMirror-foldgutter" ]
		});
		}
		 
		
	};
	
	
	
</script>
<style type="text/css">
.CodeMirror {
	border-top: 1px solid black;
	border-bottom: 1px solid black;
}
</style>
</head>

<body>

	<div id=nav>
		<!--   <a href="http://codemirror.net"><h1>CodeMirror</h1><img id=logo src="../doc/logo.png"></a>
-->

	</div>
		<div style="text-align: center;vertical-align: middle;color: #E00000 ">
		Fhir-Api for I2b2
<a href="http://www.hl7.org/FHIR/"><img src="../../images/fhir-logo-www.png"></a>
<a href="http://smarthealthit.org/"><img src="../../images/SMART_logo.png" width="80" height="60"></a>
<a href="http://i2b2.org/"><img src="../../images/i2b2.jpg" width="150" height="54"></a>

</div>
	<article>
		<h2></h2>
		<form>

			<div
				style="max-width: 100em; margin-bottom: 1em:display:block; font-size: 10px;text-align: left;">
				XML:<br>
				<textarea style="text-align: left;" id="code-xml"></textarea>
			</div>

			<div
				style="max-width: 100em; margin-bottom: 1em; display: none; font-size: 10px;">
				
			</div>
		</form>
		
	<div style="text-align: center;">
		<form id=form1 method="POST" accept-charset="UTF-8" enctype="application/x-www-form-urlencoded" 
		action="javascript:getAuth()">
			Username<input type="text"  id="username" name="username" value="demo">
			Password<input type="text" id="password" name="password" value="demouser">
			I2B2Domain<input type="text" id="i2b2domain" name="i2b2domain" value="i2b2demo">
			I2B2Url<input type="text" id="i2b2url" name="i2b2url"
				value="http://services.i2b2.org:9090/i2b2">
			<input type="submit" value="Submit">

		</form>
			</div>
	</article>
	<script>
			window.onload = getAuth() ;//setXmlDisplay("<a><b>c</b></a>")
		</script>
	
</body>
